/**
 * @Author       : gainovel
 * @Organization : Copyright Â© 2023-2024 gainovel.com All Rights Reserved.
 * @Date         : 2024-03-13 10:44:15 æ˜ŸæœŸä¸‰
 * @ProductName  : GoLand
 * @PrjectName   : test-case
 * @File         : stdlib/runtime/select/features_and_usages/comprehensive/001_test.go
 * @Version      : v0.1.0
 * @Description  : å¼€å‘ä¸­Â·Â·Â·
 **/

// qmemcodestart
package comprehensive

import (
	"fmt"
	"testing"
	"time"

	selecttools "github.com/gainovel/testcase/stdlib/runtime/select/tools"
	commonprint "github.com/gainovel/testcase/tools/common/print"
)

var (
	myfmt = commonprint.MyFmt
)

func TestName_2024_03_13_10_44_15(t *testing.T) {
	// selectçš„caseè¯­å¥åŸºæœ¬ç‰¹ç‚¹
	// go test -v -run TestName_2024_03_13_10_44_15/case1 github.com/gainovel/testcase/stdlib/runtime/select/features_and_usages/comprehensive
	t.Run("case1", func(t *testing.T) {
		var (
			ch1 chan int
			ch2 chan int
		)
		ch1 = make(chan int, 2)
		ch2 = make(chan int)
		myfmt.VarInitPrintln(`		var (
			ch1 chan int
			ch2 chan int
		)
		ch1 = make(chan int, 2)
		ch2 = make(chan int)`)
		myfmt.ColorDescPrintln("go tools.SendToIntChan(ch2)", `func SendToIntChanNTimes(ch chan int, n int) {
	for i := 0; i < n; i++ {
		ch <- i
		time.Sleep(time.Second)
	}
}`)
		go selecttools.SendToIntChanNTimes(ch2, 3)
	label1:
		for {
			select {
			case ch1 <- 1:
				myfmt.ColorDescPrintln("è¿›å…¥case ch1 <- 1")
				myfmt.KeyValuePrintln("len(ch1)", len(ch1), "cap(ch1)", cap(ch1))
				val, ok := <-ch1
				myfmt.ColorDescPrintln("val, ok := <-ch1")
				myfmt.KeyValuePrintln("len(ch1)", len(ch1), "cap(ch1)", cap(ch1), "val", val, "ok", ok)
				time.Sleep(time.Second)
			case val, ok := <-ch2:
				myfmt.ColorDescPrintln("è¿›å…¥case val, ok := <-ch2")
				myfmt.KeyValuePrintln("len(ch2)", len(ch2), "cap(ch2)", cap(ch2), "val", val, "ok", ok)
				if val == 2 {
					break label1
				}
				time.Sleep(time.Second)
			default:
				fmt.Println("è¿›å…¥case default")
			}
		}
	})
	t.Run("read block", func(t *testing.T) {
		var (
			ch1 chan int
		)
		ch1 = make(chan int, 2)
		// å¦‚æœæ²¡æœ‰ä¸€ä¸ªgoroutineåœ¨è¿è¡Œï¼Œgoè¿›ç¨‹ä¼šåœæ­¢ï¼Œ
		// æ‰€ä»¥è¿™é‡Œæ”¾ä¸€ä¸ªsleep goroutine
		go selecttools.SleepGoroutineNMinute(5)
		// ch1ç¼“å†²åŒºæ— æ•°æ®ï¼Œselectä¼šé˜»å¡
		select {
		case <-ch1:
			myfmt.ColorDescPrintln("è¿›å…¥ case <-ch1")
		}
	})
}

// qmemcodeend

// qmemoutputstart
//**************************************************************************************
//* æµ‹è¯•ç”¨ä¾‹è¿è¡Œæ–¹æ³•ï¼š
//*  0.å‰ç½®è¦æ±‚ï¼šå®‰è£…goï¼ˆversion>=1.20ï¼‰ï¼Œå®‰è£…makeï¼ˆå¯é€‰ï¼‰
//*  1.git clone git@gitee.com:gainovel/go-test-case.git ğŸ‘‰ cd go-test-case
//*    ğŸ‘‰ cd docs/tests/stdlib/runtime/select.md
//*    ğŸ‘‰ æ‰¾åˆ°å¯¹åº”çš„å‘½ä»¤ä¾æ¬¡å¤åˆ¶æ‰§è¡Œå³å¯ï¼ˆåœ¨æ ¹ç›®å½•ï¼ˆgo-test-caseï¼‰ä¸‹æ‰§è¡Œå‘½ä»¤ï¼‰
//*  2.æˆ–è€…ç›´æ¥æ‰“å¼€æµ‹è¯•æ–‡ä»¶ stdlib/runtime/select/features_and_usages/comprehensive/001.goï¼Œ
//*    æ¯ä¸ªå­æµ‹è¯•ä¸Šéƒ½æœ‰å¯¹åº”çš„å‘½ä»¤ï¼Œç›´æ¥æ‰§è¡Œå³å¯ï¼ˆåœ¨æ ¹ç›®å½•ï¼ˆgo-test-caseï¼‰ä¸‹æ‰§è¡Œå‘½ä»¤ï¼‰
//*  3. â— æ³¨æ„ï¼šæ‰€æœ‰å‘½ä»¤éƒ½åœ¨æ ¹ç›®å½•ä¸‹æ‰§è¡Œ
//**************************************************************************************
//
//ğŸ³ï¸â€ğŸŒˆ
//**************************************************************************************
//*  Test Command: make TestName_2024_03_13_10_44_15/case1 -f Makefiles/stdlib/runtime/select.mk
//*  Test Result:
//*  ğŸ‘‡
//*  å˜é‡åˆå§‹åŒ–ï¼š
//*  --------------------------------------------------------------------------------
//*                  var (
//*                          ch1 chan int
//*                          ch2 chan int
//*                  )
//*                  ch1 = make(chan int, 2)
//*                  ch2 = make(chan int)
//*  --------------------------------------------------------------------------------
//*  ğŸ‘‡
//*  go tools.SendToIntChan(ch2)
//*  func SendToIntChanNTimes(ch chan int, n int) {
//*          for i := 0; i < n; i++ {
//*                  ch <- i
//*                  time.Sleep(time.Second)
//*          }
//*  }
//*  ğŸ‘‡
//*  è¿›å…¥case ch1 <- 1
//*  --------------------------------------------------------------------------------
//*  |               key | value
//*  --------------------------------------------------------------------------------
//*  |          len(ch1) | 1
//*  |          cap(ch1) | 2
//*  --------------------------------------------------------------------------------
//*  ğŸ‘‡
//*  val, ok := <-ch1
//*  --------------------------------------------------------------------------------
//*  |               key | value
//*  --------------------------------------------------------------------------------
//*  |          len(ch1) | 0
//*  |          cap(ch1) | 2
//*  |               val | 1
//*  |                ok | true
//*  --------------------------------------------------------------------------------
//*  ğŸ‘‡
//*  è¿›å…¥case val, ok := <-ch2
//*  --------------------------------------------------------------------------------
//*  |               key | value
//*  --------------------------------------------------------------------------------
//*  |          len(ch2) | 0
//*  |          cap(ch2) | 0
//*  |               val | 0
//*  |                ok | true
//*  --------------------------------------------------------------------------------
//*  ğŸ‘‡
//*  è¿›å…¥case ch1 <- 1
//*  --------------------------------------------------------------------------------
//*  |               key | value
//*  --------------------------------------------------------------------------------
//*  |          len(ch1) | 1
//*  |          cap(ch1) | 2
//*  --------------------------------------------------------------------------------
//*  ğŸ‘‡
//*  val, ok := <-ch1
//*  --------------------------------------------------------------------------------
//*  |               key | value
//*  --------------------------------------------------------------------------------
//*  |          len(ch1) | 0
//*  |          cap(ch1) | 2
//*  |               val | 1
//*  |                ok | true
//*  --------------------------------------------------------------------------------
//*  ğŸ‘‡
//*  è¿›å…¥case val, ok := <-ch2
//*  --------------------------------------------------------------------------------
//*  |               key | value
//*  --------------------------------------------------------------------------------
//*  |          len(ch2) | 0
//*  |          cap(ch2) | 0
//*  |               val | 1
//*  |                ok | true
//*  --------------------------------------------------------------------------------
//*  ğŸ‘‡
//*  è¿›å…¥case ch1 <- 1
//*  --------------------------------------------------------------------------------
//*  |               key | value
//*  --------------------------------------------------------------------------------
//*  |          len(ch1) | 1
//*  |          cap(ch1) | 2
//*  --------------------------------------------------------------------------------
//*  ğŸ‘‡
//*  val, ok := <-ch1
//*  --------------------------------------------------------------------------------
//*  |               key | value
//*  --------------------------------------------------------------------------------
//*  |          len(ch1) | 0
//*  |          cap(ch1) | 2
//*  |               val | 1
//*  |                ok | true
//*  --------------------------------------------------------------------------------
//*  ğŸ‘‡
//*  è¿›å…¥case ch1 <- 1
//*  --------------------------------------------------------------------------------
//*  |               key | value
//*  --------------------------------------------------------------------------------
//*  |          len(ch1) | 1
//*  |          cap(ch1) | 2
//*  --------------------------------------------------------------------------------
//*  ğŸ‘‡
//*  val, ok := <-ch1
//*  --------------------------------------------------------------------------------
//*  |               key | value
//*  --------------------------------------------------------------------------------
//*  |          len(ch1) | 0
//*  |          cap(ch1) | 2
//*  |               val | 1
//*  |                ok | true
//*  --------------------------------------------------------------------------------
//*  ğŸ‘‡
//*  è¿›å…¥case val, ok := <-ch2
//*  --------------------------------------------------------------------------------
//*  |               key | value
//*  --------------------------------------------------------------------------------
//*  |          len(ch2) | 0
//*  |          cap(ch2) | 0
//*  |               val | 2
//*  |                ok | true
//*  --------------------------------------------------------------------------------
//**************************************************************************************
//
//ğŸ³ï¸â€ğŸŒˆ
//**************************************************************************************
//*  Test Command: xxx
//*  Test Result:
//*
//**************************************************************************************
//
//ğŸ³ï¸â€ğŸŒˆ
//**************************************************************************************
//*  Test Command: xxx
//*  Test Result:
//*
//**************************************************************************************
//
//ğŸ³ï¸â€ğŸŒˆ
//**************************************************************************************
//*  Test Command: xxx
//*  Test Result:
//*
//**************************************************************************************
//
// qmemoutputend
